# Project Plan: User Management and Session Control

**Overall Project Goal:** Implement a comprehensive user management and session control system for the Psychic application, transforming it into a personalized subscription service with authentication, profile management, and administrative capabilities. This implementation will leverage Firebase for Authentication and Firestore database services, with Stripe integration for payment processing.

---

### **Phase 0: Project Setup & Essential Configuration**

#### **1. Directory Structure & Dependency Setup**

* **Task 0.1: Restructure Project for Client-Server Architecture** [ ]
    * **Objective:** Establish the foundational directory structure for the client-server architecture.
    * **Action(s):** Reorganize the project into client and server directories with appropriate subdirectories.
        * Create the following directories:
            * `client/` (for the React frontend)
            * `server/` (for the Express backend)
            * `server/config/` (for configuration files)
            * `server/controllers/` (for API controllers)
            * `server/middleware/` (for Express middleware)
            * `server/models/` (for data models)
            * `server/routes/` (for API routes)
            * `server/services/` (for business logic)
            * `server/utils/` (for utility functions)
            * `client/src/components/auth/` (for authentication components)
            * `client/src/components/profile/` (for profile components)
            * `client/src/components/subscription/` (for subscription components)
            * `client/src/components/admin/` (for admin components)
            * `client/src/contexts/` (for React contexts)
            * `client/src/hooks/` (for custom React hooks)
            * `client/src/services/` (for API service modules)
            * `client/src/utils/` (for utility functions)
    * **Verification/Deliverable(s):** A correctly structured project with client and server directories containing all specified subdirectories.

* **Task 0.2: Initialize Backend Dependencies** [ ]
    * **Objective:** Set up the necessary Node.js packages for the backend.
    * **Action(s):**
        1. Navigate to the `server/` directory.
        2. Initialize a new Node.js project with `npm init -y`.
        3. Install core dependencies:
            * `express` (web framework)
            * `firebase-admin` (Firebase Admin SDK)
            * `firebase-functions` (if using Firebase Functions)
            * `cors` (for Cross-Origin Resource Sharing)
            * `dotenv` (for environment variables)
            * `jsonwebtoken` (for JWT handling)
            * `stripe` (for payment processing)
            * `joi` (for validation)
            * `helmet` (for security headers)
            * `morgan` (for logging)
        4. Install development dependencies:
            * `nodemon` (for development server)
            * `jest` (for testing)
            * `supertest` (for API testing)
    * **Verification/Deliverable(s):** Updated `server/package.json` with all specified dependencies.

* **Task 0.3: Initialize Frontend Dependencies** [ ]
    * **Objective:** Set up the necessary React packages for the frontend.
    * **Action(s):**
        1. Navigate to the `client/` directory.
        2. If not already a React project, initialize with `npx create-react-app .` or update the existing React setup.
        3. Install core dependencies:
            * `firebase` (Firebase JS SDK)
            * `react-router-dom` (for routing)
            * `axios` (for API requests)
            * `@stripe/stripe-js` (for Stripe integration)
            * `@stripe/react-stripe-js` (for Stripe React components)
            * `formik` (for form handling)
            * `yup` (for form validation)
            * `tailwindcss` (if using Tailwind CSS)
    * **Verification/Deliverable(s):** Updated `client/package.json` with all specified dependencies.

#### **2. Firebase & Stripe Setup**

* **Task 2.1: Set Up Firebase Project** [ ]
    * **Objective:** Create and configure a Firebase project for authentication and database.
    * **Action(s):**
        1. Go to the Firebase Console (firebase.google.com) and create a new project.
        2. Enable Authentication service and configure sign-in methods:
            * Email/Password
            * Google
            * Facebook (if required)
        3. Create a Firestore database in production mode.
        4. Set up security rules for Firestore.
        5. Generate and download service account credentials for server-side access.
    * **Verification/Deliverable(s):** A Firebase project with Authentication and Firestore enabled, and service account credentials downloaded.

* **Task 2.2: Set Up Stripe Account** [ ]
    * **Objective:** Create and configure a Stripe account for payment processing.
    * **Action(s):**
        1. Sign up for a Stripe account or use an existing one.
        2. Create API keys (publishable and secret).
        3. Configure webhook endpoints (for subscription events).
        4. Set up subscription products and pricing plans:
            * Monthly plan ($9.99/month)
            * Annual plan ($99.99/year)
    * **Verification/Deliverable(s):** A Stripe account with API keys, webhook configuration, and subscription plans.

* **Task 2.3: Configure Environment Variables** [ ]
    * **Objective:** Set up environment variables for secure configuration.
    * **Action(s):**
        1. Create `.env.example` files in both `server/` and `client/` directories with placeholders.
        2. Create actual `.env` files (these should be added to `.gitignore`).
        3. Configure server environment variables:
            * `FIREBASE_SERVICE_ACCOUNT_KEY_PATH` (path to service account key file)
            * `STRIPE_SECRET_KEY`
            * `STRIPE_WEBHOOK_SECRET`
            * `JWT_SECRET` (for additional token signing if needed)
            * `NODE_ENV` (development/production)
            * `PORT` (server port)
        4. Configure client environment variables:
            * `REACT_APP_FIREBASE_API_KEY`
            * `REACT_APP_FIREBASE_AUTH_DOMAIN`
            * `REACT_APP_FIREBASE_PROJECT_ID`
            * `REACT_APP_FIREBASE_STORAGE_BUCKET`
            * `REACT_APP_FIREBASE_MESSAGING_SENDER_ID`
            * `REACT_APP_FIREBASE_APP_ID`
            * `REACT_APP_STRIPE_PUBLISHABLE_KEY`
            * `REACT_APP_API_URL` (backend API URL)
    * **Verification/Deliverable(s):** `.env.example` and `.env` files created with all required variables.

---

### **Phase 1: Backend Implementation - Core Authentication & User Management**

#### **3. Firebase Configuration & Authentication Services**

* **Task 3.1: Set Up Firebase Admin SDK** [ ]
    * **Objective:** Configure Firebase Admin SDK for server-side operations.
    * **Action(s):**
        1. Create `server/config/firebase.config.js`.
        2. Initialize Firebase Admin SDK with service account credentials.
        3. Export Firebase Admin app, Auth, and Firestore instances.
    * **Verification/Deliverable(s):** Firebase Admin SDK correctly configured and exported.

* **Task 3.2: Implement Authentication Service** [ ]
    * **Objective:** Create a service for handling authentication operations.
    * **Action(s):**
        1. Create `server/services/auth.service.js`.
        2. Implement functions for:
            * Verifying Firebase ID tokens
            * Creating custom tokens (if needed)
            * Managing user sessions
            * Handling password reset requests
    * **Verification/Deliverable(s):** Authentication service with implemented functions.

#### **4. User Data Models & Repositories**

* **Task 4.1: Define User Data Model** [ ]
    * **Objective:** Create a data model for user profiles.
    * **Action(s):**
        1. Create `server/models/user.model.js`.
        2. Define the user schema with fields:
            * `uid` (Firebase Auth UID)
            * `email`
            * `displayName`
            * `photoURL` (optional)
            * `createdAt`
            * `updatedAt`
            * `role` (user/admin)
            * `preferences` (object for user preferences)
    * **Verification/Deliverable(s):** User model defined with all required fields.

* **Task 4.2: Implement User Repository** [ ]
    * **Objective:** Create a repository for user data operations.
    * **Action(s):**
        1. Create `server/services/user.service.js`.
        2. Implement functions for:
            * Creating a user profile
            * Getting a user profile by UID
            * Updating a user profile
            * Deleting a user profile
            * Listing users (for admin)
    * **Verification/Deliverable(s):** User repository with implemented CRUD operations.

* **Task 4.3: Define Reading History Model** [ ]
    * **Objective:** Create a data model for storing reading history.
    * **Action(s):**
        1. Create `server/models/reading.model.js`.
        2. Define the reading history schema with fields:
            * `id` (auto-generated)
            * `userId` (reference to user)
            * `type` (tarot, palm, astrology, etc.)
            * `content` (the reading content)
            * `createdAt`
            * `metadata` (additional reading-specific data)
    * **Verification/Deliverable(s):** Reading history model defined with all required fields.

* **Task 4.4: Implement Reading History Repository** [ ]
    * **Objective:** Create a repository for reading history operations.
    * **Action(s):**
        1. Create `server/services/reading.service.js`.
        2. Implement functions for:
            * Saving a reading
            * Getting a reading by ID
            * Listing readings for a user
            * Deleting a reading
    * **Verification/Deliverable(s):** Reading history repository with implemented CRUD operations.

#### **5. Authentication Middleware & Controllers**

* **Task 5.1: Implement Authentication Middleware** [ ]
    * **Objective:** Create middleware for protecting routes.
    * **Action(s):**
        1. Create `server/middleware/auth.middleware.js`.
        2. Implement middleware functions:
            * `verifyToken` - Verifies the Firebase ID token in the request
            * `requireAuth` - Ensures the user is authenticated
            * `requireAdmin` - Ensures the user is an admin
    * **Verification/Deliverable(s):** Authentication middleware with implemented functions.

* **Task 5.2: Implement Authentication Controllers** [ ]
    * **Objective:** Create controllers for authentication endpoints.
    * **Action(s):**
        1. Create `server/controllers/auth.controller.js`.
        2. Implement controller functions:
            * `register` - Creates a new user in Firebase Auth and Firestore
            * `login` - Validates credentials (handled client-side with Firebase)
            * `logout` - Handles session termination
            * `resetPassword` - Initiates password reset
            * `verifyEmail` - Handles email verification
    * **Verification/Deliverable(s):** Authentication controllers with implemented functions.

* **Task 5.3: Implement User Profile Controllers** [ ]
    * **Objective:** Create controllers for user profile endpoints.
    * **Action(s):**
        1. Create `server/controllers/user.controller.js`.
        2. Implement controller functions:
            * `getProfile` - Gets the current user's profile
            * `updateProfile` - Updates the user's profile
            * `deleteAccount` - Deletes the user's account
    * **Verification/Deliverable(s):** User profile controllers with implemented functions.

* **Task 5.4: Implement Reading History Controllers** [ ]
    * **Objective:** Create controllers for reading history endpoints.
    * **Action(s):**
        1. Create `server/controllers/reading.controller.js`.
        2. Implement controller functions:
            * `saveReading` - Saves a new reading
            * `getReadingHistory` - Gets the user's reading history
            * `getReading` - Gets a specific reading
            * `deleteReading` - Deletes a reading
    * **Verification/Deliverable(s):** Reading history controllers with implemented functions.

#### **6. API Routes**

* **Task 6.1: Define Authentication Routes** [ ]
    * **Objective:** Create routes for authentication endpoints.
    * **Action(s):**
        1. Create `server/routes/auth.routes.js`.
        2. Define routes:
            * `POST /api/auth/register` - Register a new user
            * `POST /api/auth/login` - Login (may be handled client-side)
            * `POST /api/auth/logout` - Logout
            * `POST /api/auth/reset-password` - Reset password
            * `POST /api/auth/verify-email` - Verify email
    * **Verification/Deliverable(s):** Authentication routes defined and connected to controllers.

* **Task 6.2: Define User Profile Routes** [ ]
    * **Objective:** Create routes for user profile endpoints.
    * **Action(s):**
        1. Create `server/routes/user.routes.js`.
        2. Define routes:
            * `GET /api/users/profile` - Get current user profile
            * `PUT /api/users/profile` - Update user profile
            * `DELETE /api/users/profile` - Delete user account
    * **Verification/Deliverable(s):** User profile routes defined and connected to controllers.

* **Task 6.3: Define Reading History Routes** [ ]
    * **Objective:** Create routes for reading history endpoints.
    * **Action(s):**
        1. Create `server/routes/reading.routes.js`.
        2. Define routes:
            * `GET /api/readings/history` - Get user's reading history
            * `GET /api/readings/history/:id` - Get specific reading
            * `POST /api/readings/save` - Save new reading
            * `DELETE /api/readings/history/:id` - Delete reading
    * **Verification/Deliverable(s):** Reading history routes defined and connected to controllers.

* **Task 6.4: Configure Express Router** [ ]
    * **Objective:** Set up the main Express router with all routes.
    * **Action(s):**
        1. Create `server/routes/index.js`.
        2. Import and configure all route modules.
        3. Export the configured router.
    * **Verification/Deliverable(s):** Main router configured with all routes.

---

### **Phase 2: Backend Implementation - Subscription & Admin Features**

#### **7. Subscription Management**

* **Task 7.1: Define Subscription Model** [ ]
    * **Objective:** Create a data model for subscriptions.
    * **Action(s):**
        1. Create `server/models/subscription.model.js`.
        2. Define the subscription schema with fields:
            * `userId` (reference to user)
            * `stripeCustomerId` (Stripe customer ID)
            * `stripeSubscriptionId` (Stripe subscription ID)
            * `plan` (monthly/annual/free)
            * `status` (active/canceled/past_due)
            * `currentPeriodStart`
            * `currentPeriodEnd`
            * `cancelAtPeriodEnd` (boolean)
    * **Verification/Deliverable(s):** Subscription model defined with all required fields.

* **Task 7.2: Implement Stripe Service** [ ]
    * **Objective:** Create a service for Stripe operations.
    * **Action(s):**
        1. Create `server/services/stripe.service.js`.
        2. Initialize Stripe with the secret key.
        3. Implement functions for:
            * Creating a customer
            * Creating a subscription
            * Updating a subscription
            * Canceling a subscription
            * Handling webhook events
    * **Verification/Deliverable(s):** Stripe service with implemented functions.

* **Task 7.3: Implement Subscription Service** [ ]
    * **Objective:** Create a service for subscription operations.
    * **Action(s):**
        1. Create `server/services/subscription.service.js`.
        2. Implement functions for:
            * Creating a subscription
            * Getting a subscription by user ID
            * Updating a subscription
            * Canceling a subscription
    * **Verification/Deliverable(s):** Subscription service with implemented functions.

* **Task 7.4: Implement Subscription Controllers** [ ]
    * **Objective:** Create controllers for subscription endpoints.
    * **Action(s):**
        1. Create `server/controllers/subscription.controller.js`.
        2. Implement controller functions:
            * `getPlans` - Gets available subscription plans
            * `subscribe` - Creates a new subscription
            * `getSubscription` - Gets the user's subscription
            * `updateSubscription` - Changes the subscription plan
            * `cancelSubscription` - Cancels the subscription
            * `handleWebhook` - Handles Stripe webhook events
    * **Verification/Deliverable(s):** Subscription controllers with implemented functions.

* **Task 7.5: Define Subscription Routes** [ ]
    * **Objective:** Create routes for subscription endpoints.
    * **Action(s):**
        1. Create `server/routes/subscription.routes.js`.
        2. Define routes:
            * `GET /api/subscriptions/plans` - Get available plans
            * `POST /api/subscriptions/subscribe` - Create subscription
            * `GET /api/subscriptions` - Get user's subscription
            * `PUT /api/subscriptions/change` - Change subscription
            * `DELETE /api/subscriptions/cancel` - Cancel subscription
            * `POST /api/subscriptions/webhook` - Stripe webhook
    * **Verification/Deliverable(s):** Subscription routes defined and connected to controllers.

#### **8. Admin Features**

* **Task 8.1: Implement Admin Service** [ ]
    * **Objective:** Create a service for admin operations.
    * **Action(s):**
        1. Create `server/services/admin.service.js`.
        2. Implement functions for:
            * Listing all users
            * Getting user details
            * Updating user status
            * Getting content for moderation
            * Updating content moderation status
    * **Verification/Deliverable(s):** Admin service with implemented functions.

* **Task 8.2: Implement Admin Controllers** [ ]
    * **Objective:** Create controllers for admin endpoints.
    * **Action(s):**
        1. Create `server/controllers/admin.controller.js`.
        2. Implement controller functions:
            * `getUsers` - Lists all users
            * `getUser` - Gets specific user details
            * `updateUser` - Updates user status
            * `getContentForModeration` - Gets content for moderation
            * `moderateContent` - Updates content moderation status
    * **Verification/Deliverable(s):** Admin controllers with implemented functions.

* **Task 8.3: Define Admin Routes** [ ]
    * **Objective:** Create routes for admin endpoints.
    * **Action(s):**
        1. Create `server/routes/admin.routes.js`.
        2. Define routes:
            * `GET /api/admin/users` - List all users
            * `GET /api/admin/users/:id` - Get user details
            * `PUT /api/admin/users/:id` - Update user status
            * `GET /api/admin/moderation` - Get content for moderation
            * `PUT /api/admin/moderation/:id` - Update content status
    * **Verification/Deliverable(s):** Admin routes defined and connected to controllers.

#### **9. Server Configuration & Error Handling**

* **Task 9.1: Implement Error Handling Middleware** [ ]
    * **Objective:** Create middleware for consistent error handling.
    * **Action(s):**
        1. Create `server/middleware/error.middleware.js`.
        2. Implement middleware for:
            * Catching and formatting errors
            * Handling 404 (not found) errors
            * Handling validation errors
    * **Verification/Deliverable(s):** Error handling middleware implemented.

* **Task 9.2: Configure Express Server** [ ]
    * **Objective:** Set up the main Express server with middleware and routes.
    * **Action(s):**
        1. Update `server/server.js`.
        2. Configure middleware:
            * CORS
            * JSON parsing
            * Helmet (security headers)
            * Morgan (logging)
            * Error handling
        3. Mount all routes.
        4. Set up server listening.
    * **Verification/Deliverable(s):** Express server configured with all middleware and routes.

---

### **Phase 3: Frontend Implementation - Authentication & User Profile**

#### **10. Firebase Client Setup & Authentication Components**

* **Task 10.1: Configure Firebase Client SDK** [ ]
    * **Objective:** Set up Firebase client SDK for frontend authentication.
    * **Action(s):**
        1. Create `client/src/utils/firebase.js`.
        2. Initialize Firebase with configuration from environment variables.
        3. Export Firebase Auth instance.
    * **Verification/Deliverable(s):** Firebase client SDK correctly configured.

* **Task 10.2: Implement Authentication Context** [ ]
    * **Objective:** Create a context for managing authentication state.
    * **Action(s):**
        1. Create `client/src/contexts/AuthContext.jsx`.
        2. Implement the AuthProvider component with:
            * Current user state
            * Loading state
            * Functions for login, logout, registration
            * Error handling
        3. Export the context and provider.
    * **Verification/Deliverable(s):** Authentication context implemented with all required functionality.

* **Task 10.3: Create Login Component** [ ]
    * **Objective:** Create a component for user login.
    * **Action(s):**
        1. Create `client/src/components/auth/Login.jsx`.
        2. Implement the Login component with:
            * Email/password login form
            * Social login buttons (Google, Facebook)
            * Error handling and validation
            * "Forgot Password" link
            * Link to registration
    * **Verification/Deliverable(s):** Login component implemented with all required functionality.

* **Task 10.4: Create Registration Component** [ ]
    * **Objective:** Create a component for user registration.
    * **Action(s):**
        1. Create `client/src/components/auth/Register.jsx`.
        2. Implement the Register component with:
            * Registration form (email, password, name)
            * Social registration buttons
            * Error handling and validation
            * Terms of service acceptance
            * Link to login
    * **Verification/Deliverable(s):** Registration component implemented with all required functionality.

* **Task 10.5: Create Password Reset Component** [ ]
    * **Objective:** Create a component for password reset.
    * **Action(s):**
        1. Create `client/src/components/auth/PasswordReset.jsx`.
        2. Implement the PasswordReset component with:
            * Email input form
            * Success/error messages
            * Link back to login
    * **Verification/Deliverable(s):** Password reset component implemented with all required functionality.

* **Task 10.6: Implement Protected Route Component** [ ]
    * **Objective:** Create a component for protecting authenticated routes.
    * **Action(s):**
        1. Create `client/src/components/common/ProtectedRoute.jsx`.
        2. Implement the ProtectedRoute component that:
            * Checks if user is authenticated
            * Redirects to login if not authenticated
            * Shows loading state while checking
            * Renders the protected component if authenticated
    * **Verification/Deliverable(s):** Protected route component implemented with all required functionality.

#### **11. User Profile Components**

* **Task 11.1: Implement User Context** [ ]
    * **Objective:** Create a context for managing user profile data.
    * **Action(s):**
        1. Create `client/src/contexts/UserContext.jsx`.
        2. Implement the UserProvider component with:
            * User profile state
            * Loading state
            * Functions for getting and updating profile
            * Error handling
        3. Export the context and provider.
    * **Verification/Deliverable(s):** User context implemented with all required functionality.

* **Task 11.2: Create Profile View Component** [ ]
    * **Objective:** Create a component for viewing user profile.
    * **Action(s):**
        1. Create `client/src/components/profile/ProfileView.jsx`.
        2. Implement the ProfileView component with:
            * Display of user information (name, email)
            * Account status and subscription details
            * Link to edit profile
            * Link to subscription management
            * Account deletion option
    * **Verification/Deliverable(s):** Profile view component implemented with all required functionality.

* **Task 11.3: Create Profile Edit Component** [ ]
    * **Objective:** Create a component for editing user profile.
    * **Action(s):**
        1. Create `client/src/components/profile/ProfileEdit.jsx`.
        2. Implement the ProfileEdit component with:
            * Form for editing profile information
            * Validation and error handling
            * Save and cancel buttons
    * **Verification/Deliverable(s):** Profile edit component implemented with all required functionality.

* **Task 11.4: Create Reading History Component** [ ]
    * **Objective:** Create a component for viewing reading history.
    * **Action(s):**
        1. Create `client/src/components/profile/ReadingHistory.jsx`.
        2. Implement the ReadingHistory component with:
            * List of past readings with dates and types
            * Pagination for many readings
            * Option to view full reading details
            * Option to delete readings
    * **Verification/Deliverable(s):** Reading history component implemented with all required functionality.

---

### **Phase 4: Frontend Implementation - Subscription & Admin Features**

#### **12. Subscription Components**

* **Task 12.1: Configure Stripe Client** [ ]
    * **Objective:** Set up Stripe client for frontend payment processing.
    * **Action(s):**
        1. Create `client/src/utils/stripe.js`.
        2. Initialize Stripe with the publishable key.
        3. Export the Stripe instance.
    * **Verification/Deliverable(s):** Stripe client correctly configured.

* **Task 12.2: Implement Subscription Hook** [ ]
    * **Objective:** Create a hook for managing subscription data.
    * **Action(s):**
        1. Create `client/src/hooks/useSubscription.js`.
        2. Implement the useSubscription hook with:
            * Subscription state
            * Loading state
            * Functions for getting, creating, updating, and canceling subscriptions
            * Error handling
    * **Verification/Deliverable(s):** Subscription hook implemented with all required functionality.

* **Task 12.3: Create Plan Selection Component** [ ]
    * **Objective:** Create a component for selecting subscription plans.
    * **Action(s):**
        1. Create `client/src/components/subscription/PlanSelection.jsx`.
        2. Implement the PlanSelection component with:
            * Display of available plans with features and pricing
            * Comparison of different plans
            * Selection mechanism
            * Proceed to payment button
    * **Verification/Deliverable(s):** Plan selection component implemented with all required functionality.

* **Task 12.4: Create Payment Form Component** [ ]
    * **Objective:** Create a component for payment processing.
    * **Action(s):**
        1. Create `client/src/components/subscription/PaymentForm.jsx`.
        2. Implement the PaymentForm component with:
            * Stripe Elements for secure card input
            * Billing information form
            * Error handling and validation
            * Submit button
            * Loading state during processing
    * **Verification/Deliverable(s):** Payment form component implemented with all required functionality.

* **Task 12.5: Create Subscription Management Component** [ ]
    * **Objective:** Create a component for managing existing subscriptions.
    * **Action(s):**
        1. Create `client/src/components/subscription/SubscriptionManagement.jsx`.
        2. Implement the SubscriptionManagement component with:
            * Display of current subscription details
            * Options to upgrade/downgrade
            * Option to cancel
            * Billing history
    * **Verification/Deliverable(s):** Subscription management component implemented with all required functionality.

#### **13. Admin Components**

* **Task 13.1: Create Admin Dashboard Component** [ ]
    * **Objective:** Create a component for the admin dashboard.
    * **Action(s):**
        1. Create `client/src/components/admin/Dashboard.jsx`.
        2. Implement the Dashboard component with:
            * Overview of users, subscriptions, and content
            * Quick access to management features
            * Key metrics and statistics
    * **Verification/Deliverable(s):** Admin dashboard component implemented with all required functionality.

* **Task 13.2: Create User Management Component** [ ]
    * **Objective:** Create a component for managing users.
    * **Action(s):**
        1. Create `client/src/components/admin/UserManagement.jsx`.
        2. Implement the UserManagement component with:
            * List of users with search and filter
            * User details view
            * Options to disable/enable accounts
            * Option to reset passwords
    * **Verification/Deliverable(s):** User management component implemented with all required functionality.

* **Task 13.3: Create Content Moderation Component** [ ]
    * **Objective:** Create a component for moderating content.
    * **Action(s):**
        1. Create `client/src/components/admin/ContentModeration.jsx`.
        2. Implement the ContentModeration component with:
            * List of content for moderation
            * Content details view
            * Options to approve/reject/flag content
            * User warning system
    * **Verification/Deliverable(s):** Content moderation component implemented with all required functionality.

#### **14. Navigation & Layout Updates**

* **Task 14.1: Update Navigation Component** [ ]
    * **Objective:** Update the navigation to support authenticated state.
    * **Action(s):**
        1. Update `client/src/components/Navigation.jsx`.
        2. Add:
            * User menu in navigation bar
            * Profile icon display
            * Login/logout buttons
            * Admin dashboard link (for admins)
    * **Verification/Deliverable(s):** Navigation component updated with authentication support.

* **Task 14.2: Create User Menu Component** [ ]
    * **Objective:** Create a dropdown menu for authenticated users.
    * **Action(s):**
        1. Create `client/src/components/layout/UserMenu.jsx`.
        2. Implement the UserMenu component with:
            * Profile link
            * Account settings link
            * Subscription management link
            * Logout option
    * **Verification/Deliverable(s):** User menu component implemented with all required functionality.

* **Task 14.3: Update App Component with Routes** [ ]
    * **Objective:** Configure application routes with authentication.
    * **Action(s):**
        1. Update `client/src/App.jsx`.
        2. Set up React Router with:
            * Public routes (home, login, register)
            * Protected routes (profile, readings, subscription)
            * Admin routes (dashboard, user management, moderation)
            * Not found route
        3. Wrap the application with necessary providers:
            * AuthProvider
            * UserProvider
            * Router
    * **Verification/Deliverable(s):** App component updated with all routes and providers.

---

### **Phase 5: Integration & Testing**

#### **15. API Service Integration**

* **Task 15.1: Implement API Client** [ ]
    * **Objective:** Create a centralized API client for frontend-backend communication.
    * **Action(s):**
        1. Create `client/src/services/api.js`.
        2. Implement an Axios instance with:
            * Base URL configuration
            * Authentication token injection
            * Error handling
            * Response transformation
    * **Verification/Deliverable(s):** API client implemented with all required functionality.

* **Task 15.2: Implement Authentication Service** [ ]
    * **Objective:** Create a service for authentication API calls.
    * **Action(s):**
        1. Create `client/src/services/auth.service.js`.
        2. Implement functions for:
            * Registration
            * Login
            * Logout
            * Password reset
            * Email verification
    * **Verification/Deliverable(s):** Authentication service implemented with all required functionality.

* **Task 15.3: Implement User Service** [ ]
    * **Objective:** Create a service for user profile API calls.
    * **Action(s):**
        1. Create `client/src/services/user.service.js`.
        2. Implement functions for:
            * Getting user profile
            * Updating user profile
            * Deleting user account
    * **Verification/Deliverable(s):** User service implemented with all required functionality.

* **Task 15.4: Implement Reading Service** [ ]
    * **Objective:** Create a service for reading history API calls.
    * **Action(s):**
        1. Create `client/src/services/reading.service.js`.
        2. Implement functions for:
            * Getting reading history
            * Getting specific reading
            * Saving new reading
            * Deleting reading
    * **Verification/Deliverable(s):** Reading service implemented with all required functionality.

* **Task 15.5: Implement Subscription Service** [ ]
    * **Objective:** Create a service for subscription API calls.
    * **Action(s):**
        1. Create `client/src/services/subscription.service.js`.
        2. Implement functions for:
            * Getting available plans
            * Creating subscription
            * Getting user's subscription
            * Changing subscription
            * Canceling subscription
    * **Verification/Deliverable(s):** Subscription service implemented with all required functionality.

* **Task 15.6: Implement Admin Service** [ ]
    * **Objective:** Create a service for admin API calls.
    * **Action(s):**
        1. Create `client/src/services/admin.service.js`.
        2. Implement functions for:
            * Getting users
            * Getting user details
            * Updating user status
            * Getting content for moderation
            * Updating content status
    * **Verification/Deliverable(s):** Admin service implemented with all required functionality.

#### **16. Integration with Existing Psychic Features**

* **Task 16.1: Update Psychic Reading Components** [ ]
    * **Objective:** Integrate authentication and user data with existing psychic reading features.
    * **Action(s):**
        1. Update Tarot, Palm, Astrology, and other reading components to:
            * Require authentication
            * Associate readings with the current user
            * Save readings to history
            * Check subscription status for premium features
    * **Verification/Deliverable(s):** Psychic reading components updated with authentication and user data integration.

* **Task 16.2: Implement Reading History Integration** [ ]
    * **Objective:** Connect reading history with psychic reading features.
    * **Action(s):**
        1. Update reading components to:
            * Save completed readings to history
            * Allow viewing past readings
            * Enable continuing from previous readings
    * **Verification/Deliverable(s):** Reading history integrated with psychic reading features.

#### **17. Testing**

* **Task 17.1: Implement Backend Tests** [ ]
    * **Objective:** Create tests for backend functionality.
    * **Action(s):**
        1. Create unit tests for:
            * Services
            * Controllers
            * Middleware
        2. Create integration tests for:
            * API endpoints
            * Database operations
            * Authentication flow
    * **Verification/Deliverable(s):** Backend tests implemented with good coverage.

* **Task 17.2: Implement Frontend Tests** [ ]
    * **Objective:** Create tests for frontend functionality.
    * **Action(s):**
        1. Create unit tests for:
            * Components
            * Hooks
            * Services
        2. Create integration tests for:
            * Authentication flow
            * User profile management
            * Subscription management
    * **Verification/Deliverable(s):** Frontend tests implemented with good coverage.

* **Task 17.3: Perform End-to-End Testing** [ ]
    * **Objective:** Test the complete application flow.
    * **Action(s):**
        1. Test critical user journeys:
            * Registration to subscription
            * Login to reading to history
            * Profile management
            * Subscription management
        2. Test across different browsers and devices.
    * **Verification/Deliverable(s):** End-to-end tests completed with all critical paths verified.

---

### **Phase 6: Deployment & Documentation**

#### **18. Deployment**

* **Task 18.1: Configure Production Environment** [ ]
    * **Objective:** Prepare the application for production deployment.
    * **Action(s):**
        1. Create production environment variables.
        2. Configure production Firebase project.
        3. Configure production Stripe account.
        4. Set up production database rules.
    * **Verification/Deliverable(s):** Production environment configured and ready for deployment.

* **Task 18.2: Build and Deploy Frontend** [ ]
    * **Objective:** Build and deploy the frontend application.
    * **Action(s):**
        1. Run production build.
        2. Deploy to hosting service (Firebase Hosting, Vercel, Netlify, etc.).
        3. Configure custom domain if needed.
    * **Verification/Deliverable(s):** Frontend deployed and accessible.

* **Task 18.3: Deploy Backend** [ ]
    * **Objective:** Deploy the backend application.
    * **Action(s):**
        1. Deploy to hosting service (Firebase Functions, Heroku, AWS, etc.).
        2. Configure environment variables.
        3. Set up monitoring and logging.
    * **Verification/Deliverable(s):** Backend deployed and accessible.

#### **19. Documentation**

* **Task 19.1: Create User Documentation** [ ]
    * **Objective:** Create documentation for end users.
    * **Action(s):**
        1. Create user guides for:
            * Registration and login
            * Profile management
            * Subscription management
            * Using psychic reading features
    * **Verification/Deliverable(s):** User documentation created and accessible.

* **Task 19.2: Create Developer Documentation** [ ]
    * **Objective:** Create documentation for developers.
    * **Action(s):**
        1. Create technical documentation for:
            * Project structure
            * API endpoints
            * Authentication flow
            * Database schema
            * Deployment process
    * **Verification/Deliverable(s):** Developer documentation created and accessible.

* **Task 19.3: Update README** [ ]
    * **Objective:** Update the project README with essential information.
    * **Action(s):**
        1. Update README with:
            * Project overview
            * Setup instructions
            * Environment variables
            * Available scripts
            * Deployment instructions
    * **Verification/Deliverable(s):** README updated with all essential information.

---

**Conclusion:** Upon completion of all phases and tasks outlined in this plan, the Psychic application will have a fully functional user management and session control system. Users will be able to register, log in, manage their profiles, view their reading history, and subscribe to premium plans. Administrators will have tools for user management and content moderation. The application will be integrated with Firebase for authentication and database services, and with Stripe for payment processing.
